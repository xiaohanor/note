---
title: 设计模式-中介者
---
1. **问题概述**：
   * 场景：有多个敌人想要攻击玩家，但希望限制同时攻击的敌人数目，并在一个敌人死亡后让另一个敌人接替位置。如果玩家死亡，所有攻击者应返回原始位置。
   * 常见错误：很多开发者会让敌人之间或敌人和玩家之间直接通信，这样会创建强耦合和硬性引用，导致内存使用增加和代码难以维护。

2. **中介者模式（Mediator Pattern）**：
   * **概念**：中介者模式的目的是通过一个中介者（例如控制塔）来协调各对象之间的通信，而不是让对象之间直接通信。这样，每个对象只依赖于中介者类，而不关心其他对象的状态或行为。
   * **优点**：通过这种方式，可以实现“松散耦合（Loosely Coupled）”的代码，使得各个部分可以独立运行，方便后期修改和重用代码。

3. **实现步骤**：
   * 创建一个新的Actor，称为“战斗管理器（Combat Manager）”，作为中介者来处理所有的战斗逻辑。
   * **战斗管理器的职责**：
     * 追踪当前的攻击目标（`Attack Target`）和攻击者列表（`Array of Attackers`）。
     * 根据最大攻击者数量限制，决定哪些敌人可以攻击，哪些敌人需要等待。
     * 当一个敌人死亡时，指示下一个等待的敌人开始攻击。
     * 当玩家死亡时，指示所有攻击者返回原始位置。
   * 使用接口（Interface）来定义攻击者和攻击目标的行为（例如，`Attack`、`Wait`、`Retreat`等函数），使得中介者可以与任何实现这些接口的对象通信，而不需要了解对象的具体类型。

4. **用例演示**：
   * **战斗管理器（Combat Manager）**：通过创建战斗管理器，演示了如何管理敌人和玩家之间的战斗逻辑，避免敌人和玩家直接通信。
   * **事件管理器（Event Manager）**：结合上一个视频中的观察者模式（Observer Pattern），创建了一个事件管理器，使得任何Actor都可以订阅事件，而无需直接引用事件发布者。

5. **性能优化和代码解耦**：
   * 通过将通信逻辑放入中介者，可以减少不必要的依赖关系，提升代码的可读性和可维护性。
   * 事件管理器可以减少重复代码，提高性能，并使得事件处理更加集中和灵活。

6. **总结与建议**：
   * 中介者模式和观察者模式的结合使用，可以显著减少对象之间的混乱依赖，使得游戏逻辑更容易扩展和重用。
   * 采用良好的软件设计模式可以使代码更易于理解和维护，提高开发效率。

### 结论： \[#结论]

通过使用中介者模式和观察者模式，开发者可以在Unreal Engine游戏项目中实现对象之间的低耦合通信，从而提高代码的可维护性、扩展性和性能。学习和应用这些设计模式，是提高编程技能和开发复杂游戏系统的关键。
