---
title: 设计模式-对象池
---
1. **问题概述**：
   * 当频繁生成和销毁对象（如子弹、特效等）时，直接调用`Spawn Actor`生成对象和`Destroy Actor`销毁对象会导致性能和内存问题。这是因为生成和销毁对象是一个相对昂贵的CPU操作，频繁的内存分配和释放会导致内存碎片化。

2. **对象池设计模式（Object Pool Pattern）**：
   * **概念**：对象池模式建议在游戏开始时预先生成一组对象并将它们标记为“未使用”。当需要使用对象时，从池中取出并标记为“使用中”，用完后不销毁对象，而是将其返回池中。这种方式大大减少了CPU的使用，因为标记对象的使用状态比创建和销毁对象的开销要小得多。
   * **优势**：通过这种方式，可以避免频繁的内存分配和释放，从而避免内存碎片化，同时也提高了性能。

3. **应用场景**：
   * 对象池模式适用于需要频繁创建和销毁对象的情况，例如游戏中的子弹、特效等。还可以用于限制游戏中某类对象的数量（例如，游戏中同时只能有100个脚印）。

4. **实现步骤**：
   * 创建一个“池化对象”（Pulled Actor），作为任何需要池化的对象的父类。这个类包含一个布尔变量`in use`来标识对象是否在使用中，以及一个浮点变量`time to live`（存活时间）来指定对象的生命周期。
   * 创建一个“对象池组件”（Object Pool Actor Component），负责管理对象池。该组件需要知道要生成的对象类型（Pulled Actor的子类）和池的大小（预生成的对象数量）。

5. **实现细节**：
   * 在对象池组件中实现一个初始化函数，用于在游戏开始时生成指定数量的对象并将其添加到池中。
   * 实现两个主要函数：`find first available actor`用于从池中获取一个未使用的对象，`spawn from pool`用于将获取的对象设置为使用中并在游戏中进行位置更新。
   * 修改现有对象类（如子弹类），使其继承自“池化对象”，并重写其碰撞和使用逻辑，使其在碰撞后返回池中而不是销毁。

6. **注意事项与建议**：
   * 对象池模式在不再需要使用时要删除对象以释放内存，否则会占用大量内存。
   * 如果仅在特定场景下使用对象池，可以考虑不使用该方法或实现动态池大小来优化内存使用。

### 结论： \[#结论]

通过使用对象池模式，可以显著优化Unreal Engine游戏中的性能和内存管理，特别是在需要频繁生成和销毁对象的情况下。
